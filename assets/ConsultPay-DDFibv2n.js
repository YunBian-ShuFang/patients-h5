import{C as V}from"./CpPaySheet-CJJoXvvh.js";import{_ as k}from"./CpNavBar-DJXLKEri.js";import{_ as S}from"./avatar-doctor-uRRbKX0w.js";import{a as $,c as N}from"./consult-DKwhTIEN.js";import{c as O}from"./user-DgDgPz6X.js";import{d as K,r as u,k as R,q as U,z as q,b as z,c as a,h as s,t as E,w as y,u as F,f as G,o as L,_ as M}from"./index-DxsiHbDK.js";import{a as j,s as A}from"./function-call-cRy0kGF_.js";import"./index-C2gDVeZZ.js";import{S as H}from"./index-Dq4jc4WC.js";import{u as J}from"./consult-B3nWt7bb.js";import{C as Q}from"./index-DSVSFtNC.js";import{C as W}from"./index-YrVuF1XM.js";import{C as X}from"./index-C4bX3Bk5.js";import{a as Y}from"./request-uc666yY3.js";import"./CpIcon-BEJBC59c.js";import"./index-CWA1siCg.js";import"./index-CAQ9J4A5.js";import"./use-route-BFOmu3it.js";import"./use-placeholder-DGGdHVxQ.js";import"./index-HEDfruI8.js";import"./interceptor-CO5Y9v1H.js";const Z={class:"consult-pay-page"},tt={class:"pay-info"},et={class:"title"},at={class:"pay-schema"},ot=K({__name:"ConsultPay",setup(lt){const o=J(),n=u(),x=async()=>{console.log("consultStore",o.consult);const e=await $({type:o.consult.type,illnessType:o.consult.illnessType});console.log("预订单",e),n.value=e.data,o.setCoupon(e.data.couponId)},p=u(),h=async()=>{if(o.consult.patientId){const e=await O(o.consult.patientId);console.log("患者信息",e),p.value=e.data}};R(()=>{if(!["type","illnessType","depId","illnessDesc","illnessTime","consultFlag","patientId"].every(f=>o.consult[f]!==void 0))return j({title:"温馨提示",message:"问诊信息不完整请重新填写，如有未支付的问诊订单可在问诊记录中继续支付！",closeOnPopstate:!1}).then(()=>{g.push("/")});x(),h()});const d=u(!1),v=u(!1),_=u(!1),m=u(""),P=async()=>{if(!d.value)return Y("请勾选我已同意支付协议");_.value=!0;const e=await N(o.consult);console.log("订单",e),m.value=e.data.id,_.value=!1,o.clear(),v.value=!0};q(()=>{if(m.value)return!1});const g=U(),D=async()=>{try{return await A({title:"关闭支付",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"仍要关闭",confirmButtonText:"继续支付"}),!1}catch{return m.value="",g.push("/user/consult"),!0}};return(e,t)=>{var b,w;const f=k,r=X,C=Q,I=W,T=H,B=V;return L(),z("div",Z,[a(f,{title:"支付"}),s("div",tt,[s("p",et,"图文问诊 "+E((b=n.value)==null?void 0:b.payment)+" 元",1),t[2]||(t[2]=s("img",{class:"img",src:S,alt:""},null,-1)),t[3]||(t[3]=s("p",{class:"desc"},[s("span",null,"极速问诊"),s("span",null,"自动分配医生")],-1))]),a(C,null,{default:y(()=>{var l,i,c;return[a(r,{title:"优惠券",value:`-¥${(l=n.value)==null?void 0:l.couponDeduction}`},null,8,["value"]),a(r,{title:"积分抵扣",value:`-¥${(i=n.value)==null?void 0:i.pointDeduction}`},null,8,["value"]),a(r,{title:"实付款",value:`¥${(c=n.value)==null?void 0:c.actualPayment}`,class:"pay-price"},null,8,["value"])]}),_:1}),t[5]||(t[5]=s("div",{class:"pay-space"},null,-1)),a(C,null,{default:y(()=>{var l,i,c;return[a(r,{title:"患者信息",value:`${(l=p.value)==null?void 0:l.name} | ${(i=p.value)==null?void 0:i.genderValue} | ${(c=p.value)==null?void 0:c.age}岁`},null,8,["value"]),a(r,{title:"病情描述",label:F(o).consult.illnessDesc},null,8,["label"])]}),_:1}),s("div",at,[a(I,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=l=>d.value=l)},{default:y(()=>t[4]||(t[4]=[G(" 我已同意 "),s("span",{class:"text"},"支付协议",-1)])),_:1},8,["modelValue"])]),a(T,{"button-type":"primary",price:n.value?n.value.actualPayment*100:0,"button-text":"立即支付","text-align":"left",onClick:P,loading:_.value},null,8,["price","loading"]),a(B,{show:v.value,"onUpdate:show":t[1]||(t[1]=l=>v.value=l),"order-id":m.value,"actual-payment":((w=n.value)==null?void 0:w.actualPayment)??0,onClose:D},null,8,["show","order-id","actual-payment"])])}}}),It=M(ot,[["__scopeId","data-v-79194b19"]]);export{It as default};
