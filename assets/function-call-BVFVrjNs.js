import{c as he,g as oe,L as Te,P as Oe,m as ke,u as Re}from"./request-uc666yY3.js";import{t as z,m as N,n as ae,c as ie,u as Ye,$ as $e,R as ze,s as we,O as ve,a0 as D,U as p,x as ee,P as ye,Q as Ce,w as Se,a as Xe,D as J,J as Me,A as Pe,a1 as De,h as me,j as de,G as Ee,p as Ze,_ as _e,I as Ae,q as Be,e as He}from"./index-CWA1siCg.js";import{d as ne,r as B,A as le,a as b,D as X,k as re,M as We,L as Ne,K as Le,c as P,E as ue,m as be}from"./index-DxsiHbDK.js";import{I as Ue}from"./index-DAaGYlz9.js";import{c as je}from"./interceptor-CO5Y9v1H.js";const[xe,Q]=ie("swipe"),qe={loop:z,width:ae,height:ae,vertical:Boolean,autoplay:N(0),duration:N(500),touchable:z,lazyRender:Boolean,initialSwipe:N(0),indicatorColor:String,showIndicators:z,stopPropagation:z},Ie=Symbol(xe);var Fe=ne({name:xe,props:qe,emits:["change","dragStart","dragEnd"],setup(e,{emit:f,slots:w}){const t=B(),u=B(),a=le({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let x=!1;const y=he(),{children:C,linkChildren:g}=Ye(Ie),n=b(()=>C.length),r=b(()=>a[e.vertical?"height":"width"]),m=b(()=>e.vertical?y.deltaY.value:y.deltaX.value),I=b(()=>a.rect?(e.vertical?a.rect.height:a.rect.width)-r.value*n.value:0),$=b(()=>r.value?Math.ceil(Math.abs(I.value)/r.value):n.value),H=b(()=>n.value*r.value),T=b(()=>(a.active+n.value)%n.value),E=b(()=>{const o=e.vertical?"vertical":"horizontal";return y.direction.value===o}),Z=b(()=>{const o={transitionDuration:`${a.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+a.offset.toFixed(2)}px)`};if(r.value){const v=e.vertical?"height":"width",d=e.vertical?"width":"height";o[v]=`${H.value}px`,o[d]=e[d]?`${e[d]}px`:""}return o}),c=o=>{const{active:v}=a;return o?e.loop?D(v+o,-1,n.value):D(v+o,0,$.value):v},R=(o,v=0)=>{let d=o*r.value;e.loop||(d=Math.min(d,-I.value));let Y=v-d;return e.loop||(Y=D(Y,I.value,0)),Y},h=({pace:o=0,offset:v=0,emitChange:d})=>{if(n.value<=1)return;const{active:Y}=a,k=c(o),F=R(k,v);if(e.loop){if(C[0]&&F!==I.value){const se=F<I.value;C[0].setOffset(se?H.value:0)}if(C[n.value-1]&&F!==0){const se=F>0;C[n.value-1].setOffset(se?-H.value:0)}}a.active=k,a.offset=F,d&&k!==Y&&f("change",T.value)},M=()=>{a.swiping=!0,a.active<=-1?h({pace:n.value}):a.active>=n.value&&h({pace:-n.value})},K=()=>{M(),y.reset(),p(()=>{a.swiping=!1,h({pace:-1,emitChange:!0})})},L=()=>{M(),y.reset(),p(()=>{a.swiping=!1,h({pace:1,emitChange:!0})})};let V;const W=()=>clearTimeout(V),_=()=>{W(),+e.autoplay>0&&n.value>1&&(V=setTimeout(()=>{L(),_()},+e.autoplay))},A=(o=+e.initialSwipe)=>{if(!t.value)return;const v=()=>{var d,Y;if(!ve(t)){const k={width:t.value.offsetWidth,height:t.value.offsetHeight};a.rect=k,a.width=+((d=e.width)!=null?d:k.width),a.height=+((Y=e.height)!=null?Y:k.height)}n.value&&(o=Math.min(n.value-1,o),o===-1&&(o=n.value-1)),a.active=o,a.swiping=!0,a.offset=R(o),C.forEach(k=>{k.setOffset(0)}),_()};ve(t)?ue().then(v):v()},j=()=>A(a.active);let q;const G=o=>{!e.touchable||o.touches.length>1||(y.start(o),x=!1,q=Date.now(),W(),M())},i=o=>{e.touchable&&a.swiping&&(y.move(o),E.value&&(!e.loop&&(a.active===0&&m.value>0||a.active===n.value-1&&m.value<0)||(ee(o,e.stopPropagation),h({offset:m.value}),x||(f("dragStart",{index:T.value}),x=!0))))},l=()=>{if(!e.touchable||!a.swiping)return;const o=Date.now()-q,v=m.value/o;if((Math.abs(v)>.25||Math.abs(m.value)>r.value/2)&&E.value){const Y=e.vertical?y.offsetY.value:y.offsetX.value;let k=0;e.loop?k=Y>0?m.value>0?-1:1:0:k=-Math[m.value>0?"ceil":"floor"](m.value/r.value),h({pace:k,emitChange:!0})}else m.value&&h({pace:0});x=!1,a.swiping=!1,f("dragEnd",{index:T.value}),_()},s=(o,v={})=>{M(),y.reset(),p(()=>{let d;e.loop&&o===n.value?d=a.active===0?0:o:d=o%n.value,v.immediate?p(()=>{a.swiping=!1}):a.swiping=!1,h({pace:d-a.active,emitChange:!0})})},S=(o,v)=>{const d=v===T.value,Y=d?{backgroundColor:e.indicatorColor}:void 0;return P("i",{style:Y,class:Q("indicator",{active:d})},null)},O=()=>{if(w.indicator)return w.indicator({active:T.value,total:n.value});if(e.showIndicators&&n.value>1)return P("div",{class:Q("indicators",{vertical:e.vertical})},[Array(n.value).fill("").map(S)])};return oe({prev:K,next:L,state:a,resize:j,swipeTo:s}),g({size:r,props:e,count:n,activeIndicator:T}),X(()=>e.initialSwipe,o=>A(+o)),X(n,()=>A(a.active)),X(()=>e.autoplay,_),X([ye,Ce,()=>e.width,()=>e.height],j),X($e(),o=>{o==="visible"?_():W()}),re(A),We(()=>A(a.active)),ze(()=>A(a.active)),Ne(W),Le(W),we("touchmove",i,{target:u}),()=>{var o;return P("div",{ref:t,class:Q()},[P("div",{ref:u,style:Z.value,class:Q("track",{vertical:e.vertical}),onTouchstartPassive:G,onTouchend:l,onTouchcancel:l},[(o=w.default)==null?void 0:o.call(w)]),O()])}}});const Ke=Se(Fe),[Ve,Ge]=ie("swipe-item");var pe=ne({name:Ve,setup(e,{slots:f}){let w;const t=le({offset:0,inited:!1,mounted:!1}),{parent:u,index:a}=Xe(Ie);if(!u)return;const x=b(()=>{const g={},{vertical:n}=u.props;return u.size.value&&(g[n?"height":"width"]=`${u.size.value}px`),t.offset&&(g.transform=`translate${n?"Y":"X"}(${t.offset}px)`),g}),y=b(()=>{const{loop:g,lazyRender:n}=u.props;if(!n||w)return!0;if(!t.mounted)return!1;const r=u.activeIndicator.value,m=u.count.value-1,I=r===0&&g?m:r-1,$=r===m&&g?0:r+1;return w=a.value===r||a.value===I||a.value===$,w}),C=g=>{t.offset=g};return re(()=>{ue(()=>{t.mounted=!0})}),oe({setOffset:C}),()=>{var g;return P("div",{class:Ge(),style:x.value},[y.value?(g=f.default)==null?void 0:g.call(f):null])}}});const Je=Se(pe),fe=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Qe=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),ce=ie("image-preview")[1],ge=2.6,et={src:String,show:Boolean,active:Number,minZoom:J(ae),maxZoom:J(ae),rootWidth:J(Number),rootHeight:J(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var tt=ne({props:et,emits:["scale","close","longPress"],setup(e,{emit:f,slots:w}){const t=le({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),u=he(),a=B(),x=B(),y=B(!1),C=B(!1);let g=0;const n=b(()=>{const{scale:i,moveX:l,moveY:s,moving:S,zooming:O,initializing:o}=t,v={transitionDuration:O||S||o?"0s":".3s"};return(i!==1||C.value)&&(v.transform=`matrix(${i}, 0, 0, ${i}, ${l}, ${s})`),v}),r=b(()=>{if(t.imageRatio){const{rootWidth:i,rootHeight:l}=e,s=y.value?l/t.imageRatio:i;return Math.max(0,(t.scale*s-i)/2)}return 0}),m=b(()=>{if(t.imageRatio){const{rootWidth:i,rootHeight:l}=e,s=y.value?l:i*t.imageRatio;return Math.max(0,(t.scale*s-l)/2)}return 0}),I=(i,l)=>{var s;if(i=D(i,+e.minZoom,+e.maxZoom+1),i!==t.scale){const S=i/t.scale;if(t.scale=i,l){const O=Pe((s=a.value)==null?void 0:s.$el),o={x:O.width*.5,y:O.height*.5},v=t.moveX-(l.x-O.left-o.x)*(S-1),d=t.moveY-(l.y-O.top-o.y)*(S-1);t.moveX=D(v,-r.value,r.value),t.moveY=D(d,-m.value,m.value)}else t.moveX=0,t.moveY=C.value?g:0;f("scale",{scale:i,index:e.active})}},$=()=>{I(1)},H=()=>{const i=t.scale>1?1:2;I(i,i===2||C.value?{x:u.startX.value,y:u.startY.value}:void 0)};let T,E,Z,c,R,h,M,K,L=!1;const V=i=>{const{touches:l}=i;if(T=l.length,T===2&&e.disableZoom)return;const{offsetX:s}=u;u.start(i),E=t.moveX,Z=t.moveY,K=Date.now(),L=!1,t.moving=T===1&&(t.scale!==1||C.value),t.zooming=T===2&&!s.value,t.zooming&&(c=t.scale,R=fe(l))},W=i=>{const{touches:l}=i;if(u.move(i),t.moving){const{deltaX:s,deltaY:S}=u,O=s.value+E,o=S.value+Z;if((e.vertical?u.isVertical()&&Math.abs(o)>m.value:u.isHorizontal()&&Math.abs(O)>r.value)&&!L){t.moving=!1;return}L=!0,ee(i,!0),t.moveX=D(O,-r.value,r.value),t.moveY=D(o,-m.value,m.value)}if(t.zooming&&(ee(i,!0),l.length===2)){const s=fe(l),S=c*s/R;h=Qe(l),I(S,h)}},_=i=>{var l;const s=(l=x.value)==null?void 0:l.$el;if(!s)return;const S=s.firstElementChild,O=i.target===s,o=S==null?void 0:S.contains(i.target);!e.closeOnClickImage&&o||!e.closeOnClickOverlay&&O||f("close")},A=i=>{if(T>1)return;const l=Date.now()-K,s=250;u.isTap.value&&(l<s?e.doubleScale?M?(clearTimeout(M),M=null,H()):M=setTimeout(()=>{_(i),M=null},s):_(i):l>De&&f("longPress"))},j=i=>{let l=!1;if((t.moving||t.zooming)&&(l=!0,t.moving&&E===t.moveX&&Z===t.moveY&&(l=!1),!i.touches.length)){t.zooming&&(t.moveX=D(t.moveX,-r.value,r.value),t.moveY=D(t.moveY,-m.value,m.value),t.zooming=!1),t.moving=!1,E=0,Z=0,c=1,t.scale<1&&$();const s=+e.maxZoom;t.scale>s&&I(s,h)}ee(i,l),A(i),u.reset()},q=()=>{const{rootWidth:i,rootHeight:l}=e,s=l/i,{imageRatio:S}=t;y.value=t.imageRatio>s&&S<ge,C.value=t.imageRatio>s&&S>=ge,C.value&&(g=(S*i-l)/2,t.moveY=g,t.initializing=!0,Me(()=>{t.initializing=!1})),$()},G=i=>{const{naturalWidth:l,naturalHeight:s}=i.target;t.imageRatio=s/l,q()};return X(()=>e.active,$),X(()=>e.show,i=>{i||$()}),X(()=>[e.rootWidth,e.rootHeight],q),we("touchmove",W,{target:b(()=>{var i;return(i=x.value)==null?void 0:i.$el})}),oe({resetScale:$}),()=>{const i={loading:()=>P(Te,{type:"spinner"},null)};return P(Je,{ref:x,class:ce("swipe-item"),onTouchstartPassive:V,onTouchend:j,onTouchcancel:j},{default:()=>[w.image?P("div",{class:ce("image-wrap")},[w.image({src:e.src,onLoad:G,style:n.value})]):P(Ue,{ref:a,src:e.src,fit:"contain",class:ce("image",{vertical:y.value}),style:n.value,onLoad:G},i)]})}}});const[at,U]=ie("image-preview"),ot=["show","teleport","transition","overlayStyle","closeOnPopstate"],it={show:Boolean,loop:z,images:Ee(),minZoom:N(1/3),maxZoom:N(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:de,closeIcon:me("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:de,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:me("top-right"),teleport:[String,Object]};var nt=ne({name:at,props:it,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:f,slots:w}){const t=B(),u=B(),a=le({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),x=()=>{if(t.value){const c=Pe(t.value.$el);a.rootWidth=c.width,a.rootHeight=c.height,t.value.resize()}},y=c=>f("scale",c),C=c=>f("update:show",c),g=()=>{je(e.beforeClose,{args:[a.active],done:()=>C(!1)})},n=c=>{c!==a.active&&(a.active=c,f("change",c))},r=()=>{if(e.showIndex)return P("div",{class:U("index")},[w.index?w.index({index:a.active}):`${a.active+1} / ${e.images.length}`])},m=()=>{if(w.cover)return P("div",{class:U("cover")},[w.cover()])},I=()=>{a.disableZoom=!0},$=()=>{a.disableZoom=!1},H=()=>P(Ke,{ref:t,lazyRender:!0,loop:e.loop,class:U("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:n,onDragEnd:$,onDragStart:I},{default:()=>[e.images.map((c,R)=>P(tt,{ref:h=>{R===a.active&&(u.value=h)},src:c,show:e.show,active:a.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:a.rootWidth,rootHeight:a.rootHeight,disableZoom:a.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:y,onClose:g,onLongPress:()=>f("longPress",{index:R})},{image:w.image}))]}),T=()=>{if(e.closeable)return P(Ae,{role:"button",name:e.closeIcon,class:[U("close-icon",e.closeIconPosition),_e],onClick:g},null)},E=()=>f("closed"),Z=(c,R)=>{var h;return(h=t.value)==null?void 0:h.swipeTo(c,R)};return oe({resetScale:()=>{var c;(c=u.value)==null||c.resetScale()},swipeTo:Z}),re(x),X([ye,Ce],x),X(()=>e.startPosition,c=>n(+c)),X(()=>e.show,c=>{const{images:R,startPosition:h}=e;c?(n(+h),ue(()=>{x(),Z(+h,{immediate:!0})})):f("close",{index:a.active,url:R[a.active]})}),()=>P(Oe,be({class:[U(),e.className],overlayClass:[U("overlay"),e.overlayClass],onClosed:E,"onUpdate:show":C},Ze(e,ot)),{default:()=>[T(),H(),r(),m()]})}});let te;const lt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function st(){({instance:te}=ke({setup(){const{state:e,toggle:f}=Re(),w=()=>{e.images=[]};return()=>P(nt,be(e,{onClosed:w,"onUpdate:show":f}),null)}}))}const dt=(e,f=0)=>{if(Be)return te||st(),e=Array.isArray(e)?{images:e,startPosition:f}:e,te.open(He({},lt,e)),te};export{Ke as S,Je as a,dt as s};
