import{_ as O}from"./CpNavBar-DJXLKEri.js";import{g as F,a as N,c as T}from"./order-VamOOSqx.js";import{d as A,r as c,k as M,b as p,c as t,h as e,t as r,F as w,i as j,w as b,s as q,j as L,p as R,f as P,o as d,_ as U}from"./index-DxsiHbDK.js";import{C as z}from"./CpPaySheet-CJJoXvvh.js";import{T as E}from"./index-DrYP-aDN.js";import{I as G}from"./index-CWA1siCg.js";import{C as H}from"./index-DSVSFtNC.js";import{C as J}from"./index-YrVuF1XM.js";import{S as K}from"./index-Dq4jc4WC.js";import{S as Q}from"./index-Bjr7kZ_k.js";import{C as W}from"./index-C4bX3Bk5.js";import{a as x}from"./request-uc666yY3.js";import"./use-placeholder-DGGdHVxQ.js";import"./CpIcon-BEJBC59c.js";import"./consult-DKwhTIEN.js";import"./index-CAQ9J4A5.js";import"./use-route-BFOmu3it.js";import"./interceptor-CO5Y9v1H.js";const X={key:0,class:"order-pay-page"},Y={class:"order-address"},Z={class:"area"},ee={class:"detail"},ae={class:"order-medical"},te=["src"],se={class:"info"},oe={class:"name"},le={class:"size"},ne={class:"price"},re={class:"desc"},ie={class:"order-detail"},ue={class:"order-tip"},ce={key:1,class:"order-pay-page"},de=A({__name:"OrderPay",setup(pe){const C=q(),s=c(),I=async()=>{const n=await F({prescriptionId:C.query.id});s.value=n.data},l=c(),S=async()=>{const n=await N();if(n.data.length){const a=n.data.find(i=>i.isDefault===0);a?l.value=a:l.value=n.data[0]}};M(()=>{I(),S()});const f=c(!1),y=c(!1),g=c(""),V=async()=>{var n,a,i,m;if(!f.value)return x("请同意支付协议");if(!((n=l.value)!=null&&n.id))return x("请选择收货地址");if(!((a=s.value)!=null&&a.id))return x("未找到处方");if(g.value)v.value=!0;else try{y.value=!0;const u=await T({id:(i=s.value)==null?void 0:i.id,addressId:(m=l.value)==null?void 0:m.id,couponId:s.value.couponId});console.log("生成药品订单--orderPay--->",u),g.value=u.data.id,y.value=!1,v.value=!0}catch(u){console.log("生成订单--->",u),y.value=!1}},v=c(!1);return(n,a)=>{var k;const i=O,m=G,u=E,_=W,$=H,B=J,D=K,h=Q;return d(),p(w,null,[s.value&&l.value?(d(),p("div",X,[t(i,{title:"支付药款"}),e("div",Y,[e("p",Z,[t(m,{name:"location"}),e("span",null,r(l.value.province+l.value.city+l.value.county),1)]),e("p",ee,r(l.value.addressDetail),1),e("p",null,r(l.value.receiver)+" "+r(l.value.mobile.replace(/^(\d{3})\d+(\d{4})$/,"$1****$2")),1)]),e("div",ae,[a[3]||(a[3]=e("div",{class:"header"},[e("h3",null,"优医药房"),e("small",null,"优医质保 假一赔十")],-1)),(d(!0),p(w,null,j(s.value.medicines,o=>(d(),p("div",{class:"item van-hairline--top",key:o.id},[e("img",{class:"img",src:o.avatar,alt:""},null,8,te),e("div",se,[e("p",oe,[e("span",null,r(o.name),1),e("span",null,"x"+r(o.quantity),1)]),e("p",le,[o.prescriptionFlag===1?(d(),L(u,{key:0},{default:b(()=>a[2]||(a[2]=[P("处方药")])),_:1})):R("",!0),e("span",null,r(o.specs),1)]),e("p",ne,"￥"+r(o.amount),1)]),e("div",re,r(o.usageDosag),1)]))),128))]),e("div",ie,[t($,null,{default:b(()=>[t(_,{title:"药品金额",value:`￥${s.value.payment}`},null,8,["value"]),t(_,{title:"运费",value:`￥${s.value.expressFee}`},null,8,["value"]),t(_,{title:"优惠券",value:`-￥${s.value.couponDeduction}`},null,8,["value"]),t(_,{title:"实付款",value:`￥${s.value.actualPayment}`,class:"price"},null,8,["value"])]),_:1})]),e("div",ue,[a[5]||(a[5]=e("p",{class:"tip"}," 由于药品的特殊性，如非错发、漏发药品的情况，药品一经发出 不得退换，请核对药品信息无误后下单。 ",-1)),t(B,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=o=>f.value=o)},{default:b(()=>a[4]||(a[4]=[P(" 我已同意 "),e("a",{href:"javascript:;"},"支付协议",-1)])),_:1},8,["modelValue"])]),t(D,{price:s.value.actualPayment*100,"button-text":"立即支付","button-type":"primary","text-align":"left",onSubmit:V},null,8,["price"])])):(d(),p("div",ce,[t(i,{title:"支付药款"}),t(h,{title:"",avatar:"",row:"2",style:{"margin-top":"15px"}}),t(h,{title:"",row:"4",style:{"margin-top":"50px"}}),t(h,{title:"",row:"4",style:{"margin-top":"50px"}})])),t(z,{show:v.value,"onUpdate:show":a[1]||(a[1]=o=>v.value=o),orderId:g.value,actualPayment:((k=s.value)==null?void 0:k.actualPayment)??0,"pay-callback":"/order/pay/result"},null,8,["show","orderId","actualPayment"])],64)}}}),De=U(de,[["__scopeId","data-v-7f17621b"]]);export{De as default};
